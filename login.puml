@startuml
mainframe **sd** Login

hide footbox

actor "**: User**" as User
boundary "**: LoginForm**" as LoginForm
control "**: LoginController**" as LoginController
entity "**: UserRepository**" as UserRepository

User -> LoginForm : submitLogin(email, password)
activate LoginForm

LoginForm -> LoginForm : validateForm(email, password)
activate LoginForm
deactivate LoginForm


opt fields empty
    LoginForm -> LoginForm : displayError("Fields cannot be empty")
    activate LoginForm
   deactivate LoginForm
   deactivate LoginForm
end
    User -> LoginForm : submitLogin(email, password)
    activate LoginForm
    LoginForm -> LoginForm : validateForm(email, password)
    activate LoginForm
    deactivate LoginForm
    LoginForm -> LoginController : authenticateUser(email, password)
    activate LoginController

    LoginController -> UserRepository : findUserByEmail(email)
    activate UserRepository
    ' Koreksi Mistake 3.11 & 3.21: Balasan berupa data
    UserRepository --> LoginController : userData
    deactivate UserRepository

    ' Blok 'alt' ini dieksekusi oleh LoginController
    alt user not found or password mismatch
        LoginController -> LoginForm : reportFailure("Invalid email or password")
        deactivate LoginController

        LoginForm -> LoginForm : displayError("Invalid email or password")
        activate LoginForm
        deactivate LoginForm
        deactivate LoginForm
    else authentication successful
    User -> LoginForm : submitLogin(email, password)
    activate LoginForm
    LoginForm -> LoginForm : validateForm(email, password)
    activate LoginForm
    deactivate LoginForm
    LoginForm -> LoginController : authenticateUser(email, password)
    activate LoginController
    LoginController -> UserRepository : findUserByEmail(email)
    activate UserRepository
    ' Koreksi Mistake 3.11 & 3.21: Balasan berupa data
    UserRepository --> LoginController : userData
    deactivate UserRepository
        LoginController -> LoginForm : reportSuccess(userData.role)
        deactivate LoginController

        LoginForm -> LoginForm : redirectToDashboard(userData.role)
        activate LoginForm
    deactivate LoginForm
    end
@enduml