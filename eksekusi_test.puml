@startuml
mainframe "**sd** EksekusiTest"
hide footbox

actor "**: User**" as User
boundary "**: ExecutionPage**" as ExecutionPage
control "**: ExecutionController**" as ExecutionController
boundary "**: BitbucketAPI (external)**" as BitbucketAPI

' User starts execution from UI
User -> ExecutionPage : executeRun(environment, filter(tag?, group?))
activate ExecutionPage

' Client-side validation and UI work
ExecutionPage -> ExecutionPage : validateInput(environment, filter)
activate ExecutionPage
deactivate ExecutionPage

opt invalid input
    ExecutionPage -> User : showError("Invalid environment or filter")
    deactivate ExecutionPage
    return
end

' Client sends execution request to server (Next.js API)
ExecutionPage -> ExecutionController : requestExecution(environment, filter)
activate ExecutionController

' Controller prepares params and calls Bitbucket API to trigger workflow
ExecutionController -> BitbucketAPI : triggerWorkflow(workflowId, environment, filter)
activate BitbucketAPI

' Bitbucket API returns immediate acknowledgement (could include runId or status)
' (structured reply)
BitbucketAPI --> ExecutionController : ack(status, runId?)
deactivate BitbucketAPI

' Controller returns response to client
ExecutionController --> ExecutionPage : executionAck(status, runId?)
deactivate ExecutionController

alt trigger failed
    ExecutionPage -> User : showError()
else trigger successful
    ExecutionPage -> User : showSuccess()
end


deactivate ExecutionPage
@enduml
