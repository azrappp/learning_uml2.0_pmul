@startuml
mainframe "**sd** EksekusiTest"
hide footbox

actor "**: User**" as User
boundary "**: ExecutionPage**" as ExecutionPage
control "**: ExecutionController**" as ExecutionController
boundary "**: BitbucketAPI**" as BitbucketAPI

' User starts execution from UI
User -> ExecutionPage : executeRun(environment, filter(tag?, group?))
activate ExecutionPage

' Client-side validation and UI work
ExecutionPage -> ExecutionPage : validateInput(environment, filter)
activate ExecutionPage
deactivate ExecutionPage

opt invalid input
    ExecutionPage -> ExecutionPage : showError("Invalid environment or filter")
    activate ExecutionPage
    deactivate ExecutionPage
end

' Client sends execution request to server (Next.js API)
ExecutionPage -> ExecutionController : requestExecution(environment, filter)
activate ExecutionController

' Controller prepares params and calls Bitbucket API to trigger workflow
ExecutionController -> BitbucketAPI : triggerWorkflow(workflowId, environment, filter)
activate BitbucketAPI

' Bitbucket API returns immediate acknowledgement (could include runId or status)
' (structured reply)
BitbucketAPI --> ExecutionController : status
deactivate BitbucketAPI

' Controller returns response to client
ExecutionController --> ExecutionPage : status
deactivate ExecutionController

alt trigger failed
    ExecutionPage -> ExecutionPage : showError()
    activate ExecutionPage
    deactivate ExecutionPage
else trigger successful
    ExecutionPage -> ExecutionPage : showSuccess()
    activate ExecutionPage
    deactivate ExecutionPage
end


deactivate ExecutionPage
@enduml
